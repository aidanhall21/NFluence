{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useEffect, useReducer } from \"react\";\nimport { userNsftReducer } from \"../reducer/userNsftReducer\";\nimport { mutate, query, tx } from '@onflow/fcl';\nimport { MINT_NSFT } from \"../flow/mint-nsft.tx\";\nimport { authorizationFunction } from \"../services/authorization-function\";\nimport { GET_TOKEN_DATA } from \"../flow/get-token-data.script\";\nimport { CREATE_AUCTION } from \"../flow/create-auction.tx\";\nimport { GET_AUCTION_IDS } from \"../flow/get-auction-ids.script\";\nimport { GET_SINGLE_AUCTION_DATA } from \"../flow/get-single-auction-data.script\";\nimport { SETTLE_AUCTION } from \"../flow/settle-auction.tx\";\nimport { BID_ON_AUCTION } from \"../flow/bid-auction.tx\";\nimport { GET_OWNED_IDS } from \"../flow/get-owned-token-ids.script\";\nimport axios from \"axios\";\nlet api_node;\nprocess.env.NODE_ENV === \"production\" ? api_node = '' : api_node = process.env.REACT_APP_LOCAL_API_NODE;\nexport default function useUserNsfts(user) {\n  _s();\n\n  const [state, dispatch] = useReducer(userNsftReducer, {\n    loading: false,\n    error: false,\n    minted_data: [],\n    auction_data: [],\n    owned_data: [],\n    owned_ids: [],\n    bids_data: [],\n    txStatus: {}\n  });\n\n  const runScript = async (address, id) => {\n    console.log('HI', address, id);\n    let auction_data;\n\n    try {\n      auction_data = await query({\n        cadence: GET_SINGLE_AUCTION_DATA,\n        args: (arg, t) => [arg(address, t.Address), arg(id, t.UInt64)]\n      });\n      console.log(auction_data);\n    } catch (err) {\n      return;\n    }\n\n    const {\n      nftData\n    } = auction_data;\n    return { ...auction_data,\n      ...nftData\n    };\n  };\n\n  const fetchAuctionData = async (address, data) => {\n    return Promise.all(data.map(id => {\n      return runScript(address, id);\n    }));\n  };\n\n  const fetchBidData = async data => {\n    console.log(data);\n    return Promise.all(data.map(el => {\n      return runScript(el.blockEventData.owner, el.blockEventData.tokenID);\n    }));\n  };\n\n  const fetchUserMintedNsfts = async () => {\n    dispatch({\n      type: 'PROCESSING'\n    });\n\n    try {\n      let res = await query({\n        cadence: GET_TOKEN_DATA,\n        args: (arg, t) => [arg(user === null || user === void 0 ? void 0 : user.addr, t.Address)]\n      });\n      console.log(res);\n      let minted_nsfts = [];\n\n      if (res !== null) {\n        minted_nsfts = res.filter(token => token.creatorAddress === (user === null || user === void 0 ? void 0 : user.addr));\n      }\n\n      console.log(minted_nsfts);\n      dispatch({\n        type: 'MINTED_SUCCESS',\n        payload: minted_nsfts\n      });\n    } catch (err) {\n      console.log(err);\n      dispatch({\n        type: 'ERROR'\n      });\n    }\n  };\n\n  const fetchUserOwnedIds = async () => {\n    dispatch({\n      type: 'PROCESSING'\n    });\n\n    try {\n      let res = await query({\n        cadence: GET_OWNED_IDS,\n        args: (arg, t) => [arg(user === null || user === void 0 ? void 0 : user.addr, t.Address)]\n      });\n      console.log(res);\n      let owned_nsfts = [];\n\n      if (res !== null) {\n        owned_nsfts = res.filter(token => token.creatorAddress !== (user === null || user === void 0 ? void 0 : user.addr));\n      }\n\n      dispatch({\n        type: 'ID_SUCCESS',\n        payload: owned_nsfts\n      });\n    } catch (err) {\n      console.log(err);\n      dispatch({\n        type: 'ERROR'\n      });\n    }\n  };\n\n  const fetchUserOwnedNsfts = async () => {\n    dispatch({\n      type: 'PROCESSING'\n    });\n\n    try {\n      let res = await query({\n        cadence: GET_TOKEN_DATA,\n        args: (arg, t) => [arg(user === null || user === void 0 ? void 0 : user.addr, t.Address)]\n      });\n      console.log(res);\n      let owned_nsfts = [];\n\n      if (res !== null) {\n        owned_nsfts = res.filter(token => token.creatorAddress !== (user === null || user === void 0 ? void 0 : user.addr));\n      }\n\n      dispatch({\n        type: 'OWNED_SUCCESS',\n        payload: owned_nsfts\n      });\n    } catch (err) {\n      console.log(err);\n      dispatch({\n        type: 'ERROR'\n      });\n    }\n  };\n\n  const fetchUserLiveAuctions = async () => {\n    dispatch({\n      type: 'PROCESSING'\n    });\n\n    try {\n      let res = await query({\n        cadence: GET_AUCTION_IDS,\n        args: (arg, t) => [arg(user === null || user === void 0 ? void 0 : user.addr, t.Address)]\n      });\n      let data = await fetchAuctionData(user === null || user === void 0 ? void 0 : user.addr, res);\n      dispatch({\n        type: 'AUCTION_SUCCESS',\n        payload: data\n      });\n    } catch (err) {\n      dispatch({\n        type: 'ERROR'\n      });\n    }\n  };\n\n  const fetchUserLiveBids = async () => {\n    dispatch({\n      type: 'PROCESSING'\n    });\n\n    try {\n      let response = await axios.get(`https://prod-test-net-dashboard-api.azurewebsites.net/api/company/04a74a09-619e-47f3-a6b4-99d24ce69971/search?user=${user === null || user === void 0 ? void 0 : user.addr}`);\n      const bidData = response.data;\n      const result = bidData.filter(event => event.flowEventId === \"A.a3c018ee20b2cb65.NFluenceAuction.BidPlaced\");\n      let tokens = result.filter((event, index, self) => index === self.findIndex(e => e.blockEventData.tokenID === event.blockEventData.tokenID));\n      const livebids = fetchBidData(tokens);\n      dispatch({\n        type: 'BID_SUCCESS',\n        payload: livebids\n      });\n    } catch (err) {\n      dispatch({\n        type: 'ERROR'\n      });\n    }\n  };\n\n  useEffect(() => {\n    if (!(user === null || user === void 0 ? void 0 : user.addr)) return;\n    fetchUserMintedNsfts();\n    fetchUserOwnedNsfts();\n    fetchUserOwnedIds();\n    fetchUserLiveAuctions();\n    fetchUserLiveBids(); //eslint-disable-next-line\n  }, [user]);\n\n  const fetchAccountLiveAuctions = async address => {\n    try {\n      let res = await query({\n        cadence: GET_AUCTION_IDS,\n        args: (arg, t) => [arg(address, t.Address)]\n      });\n      let data = await fetchAuctionData(address, res);\n      return data;\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const addToAuction = async (nftid, price) => {\n    dispatch({\n      type: 'PROCESSING'\n    });\n\n    try {\n      let res = await mutate({\n        cadence: CREATE_AUCTION,\n        args: (arg, t) => [arg(nftid, t.UInt64), arg(price, t.UFix64)],\n        limit: 9999\n      });\n      let txStatus = await tx(res).onceSealed();\n      console.log('done!');\n      console.log(txStatus);\n      dispatch({\n        type: 'TX_SUCCESS',\n        payload: txStatus\n      });\n      return txStatus;\n    } catch (err) {\n      console.log(err);\n      dispatch({\n        type: 'ERROR'\n      });\n    }\n  };\n\n  const bidOnAuction = async (nftid, address, price) => {\n    dispatch({\n      type: 'PROCESSING'\n    });\n\n    try {\n      let res = await mutate({\n        cadence: BID_ON_AUCTION,\n        args: (arg, t) => [arg(nftid, t.UInt64), arg(address, t.Address), arg(price, t.UFix64)],\n        limit: 9999\n      });\n      let txStatus = await tx(res).onceSealed();\n      console.log(txStatus);\n      dispatch({\n        type: 'TX_SUCCESS',\n        payload: txStatus\n      });\n    } catch (err) {\n      console.log(err);\n      dispatch({\n        type: 'ERROR'\n      });\n    }\n  };\n\n  const settleAuction = async nftid => {\n    console.log(state.error);\n    dispatch({\n      type: 'PROCESSING'\n    });\n\n    try {\n      let res = await mutate({\n        cadence: SETTLE_AUCTION,\n        args: (arg, t) => [arg(nftid, t.UInt64)],\n        limit: 9999\n      });\n      let txStatus = await tx(res).onceSealed();\n      console.log(txStatus);\n      dispatch({\n        type: 'TX_SUCCESS',\n        payload: txStatus\n      });\n      return txStatus;\n    } catch (err) {\n      console.log(err);\n      dispatch({\n        type: 'ERROR'\n      });\n    }\n  };\n\n  const mintNsft = async (cid, fileType, title, description, editionSize) => {\n    dispatch({\n      type: 'PROCESSING'\n    });\n\n    try {\n      let res = await mutate({\n        cadence: MINT_NSFT,\n        args: (arg, t) => [arg(user === null || user === void 0 ? void 0 : user.addr, t.Address), arg(cid, t.String), arg(fileType, t.UInt8), arg(title, t.String), arg(description, t.String), arg(editionSize, t.UInt16)],\n        limit: 9999\n      }); //addTx(res)\n\n      let txStatus = await tx(res).onceSealed();\n      dispatch({\n        type: 'TX_SUCCESS',\n        payload: txStatus\n      });\n      return txStatus;\n    } catch (err) {\n      console.log(err);\n      dispatch({\n        type: 'ERROR'\n      });\n    }\n  };\n\n  return { ...state,\n    mintNsft,\n    addToAuction,\n    settleAuction,\n    fetchAccountLiveAuctions,\n    fetchUserMintedNsfts,\n    fetchUserOwnedNsfts,\n    fetchUserOwnedIds,\n    bidOnAuction\n  };\n}\n\n_s(useUserNsfts, \"mVN2j7Uz2lx1FuliDgbhEGBy0Hg=\");","map":{"version":3,"sources":["/Users/aidanhall/Desktop/nsft/client/src/hooks/use-user-nfts.hook.js"],"names":["useEffect","useReducer","userNsftReducer","mutate","query","tx","MINT_NSFT","authorizationFunction","GET_TOKEN_DATA","CREATE_AUCTION","GET_AUCTION_IDS","GET_SINGLE_AUCTION_DATA","SETTLE_AUCTION","BID_ON_AUCTION","GET_OWNED_IDS","axios","api_node","process","env","NODE_ENV","REACT_APP_LOCAL_API_NODE","useUserNsfts","user","state","dispatch","loading","error","minted_data","auction_data","owned_data","owned_ids","bids_data","txStatus","runScript","address","id","console","log","cadence","args","arg","t","Address","UInt64","err","nftData","fetchAuctionData","data","Promise","all","map","fetchBidData","el","blockEventData","owner","tokenID","fetchUserMintedNsfts","type","res","addr","minted_nsfts","filter","token","creatorAddress","payload","fetchUserOwnedIds","owned_nsfts","fetchUserOwnedNsfts","fetchUserLiveAuctions","fetchUserLiveBids","response","get","bidData","result","event","flowEventId","tokens","index","self","findIndex","e","livebids","fetchAccountLiveAuctions","addToAuction","nftid","price","UFix64","limit","onceSealed","bidOnAuction","settleAuction","mintNsft","cid","fileType","title","description","editionSize","String","UInt8","UInt16"],"mappings":"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","sourcesContent":["import { useEffect, useReducer } from \"react\";\nimport { userNsftReducer } from \"../reducer/userNsftReducer\";\nimport { mutate, query, tx } from '@onflow/fcl';\nimport { MINT_NSFT } from \"../flow/mint-nsft.tx\";\nimport { authorizationFunction } from \"../services/authorization-function\";\nimport { GET_TOKEN_DATA } from \"../flow/get-token-data.script\";\nimport { CREATE_AUCTION } from \"../flow/create-auction.tx\";\nimport { GET_AUCTION_IDS } from \"../flow/get-auction-ids.script\";\nimport { GET_SINGLE_AUCTION_DATA } from \"../flow/get-single-auction-data.script\";\nimport { SETTLE_AUCTION } from \"../flow/settle-auction.tx\";\nimport { BID_ON_AUCTION } from \"../flow/bid-auction.tx\";\nimport { GET_OWNED_IDS } from \"../flow/get-owned-token-ids.script\";\nimport axios from \"axios\";\n\nlet api_node;\n\nprocess.env.NODE_ENV === \"production\"\n  ? api_node = ''\n  : api_node = process.env.REACT_APP_LOCAL_API_NODE\n\nexport default function useUserNsfts(user) {\n    const [state, dispatch] = useReducer(userNsftReducer, {\n        loading: false,\n        error: false,\n        minted_data: [],\n        auction_data: [],\n        owned_data: [],\n        owned_ids: [],\n        bids_data: [],\n        txStatus: {}\n    })\n\n    const runScript = async (address, id) => {\n        console.log('HI', address, id)\n        let auction_data;\n        try {\n            auction_data = await query({\n                cadence: GET_SINGLE_AUCTION_DATA,\n                args: (arg, t) => [arg(address, t.Address), arg(id, t.UInt64)]\n            })\n            console.log(auction_data)\n        } catch (err) {\n            return\n        }\n        const { nftData } = auction_data\n        return {...auction_data, ...nftData}\n    }\n\n    const fetchAuctionData = async (address, data) => {\n        return Promise.all(data.map((id) => {\n            return runScript(address, id)\n        }))\n    }\n\n    const fetchBidData = async (data) => {\n        console.log(data)\n        return Promise.all(data.map((el) => {\n            return runScript(el.blockEventData.owner, el.blockEventData.tokenID)\n        }))\n    }\n\n    const fetchUserMintedNsfts = async () => {\n        dispatch({ type: 'PROCESSING' })\n        try {\n            let res = await query({\n                cadence: GET_TOKEN_DATA,\n                args: (arg, t) => [arg(user?.addr, t.Address)]\n            })\n            console.log(res)\n            let minted_nsfts = []\n            if (res !== null) {\n                minted_nsfts = res.filter(token => token.creatorAddress === user?.addr)\n            }\n            console.log(minted_nsfts)\n            dispatch({ type: 'MINTED_SUCCESS', payload: minted_nsfts })\n        } catch (err) {\n            console.log(err)\n            dispatch({ type: 'ERROR' })\n        }\n    }\n\n    const fetchUserOwnedIds = async () => {\n        dispatch({ type: 'PROCESSING' })\n        try {\n            let res = await query({\n                cadence: GET_OWNED_IDS,\n                args: (arg, t) => [arg(user?.addr, t.Address)]\n            })\n            console.log(res)\n            let owned_nsfts = []\n            if (res !== null) {\n                owned_nsfts = res.filter(token => token.creatorAddress !== user?.addr)\n            }\n            dispatch({ type: 'ID_SUCCESS', payload: owned_nsfts })\n        } catch(err) {\n            console.log(err)\n            dispatch({ type: 'ERROR' })\n        }\n    }\n\n    const fetchUserOwnedNsfts = async () => {\n        dispatch({ type: 'PROCESSING' })\n        try {\n            let res = await query({\n                cadence: GET_TOKEN_DATA,\n                args: (arg, t) => [arg(user?.addr, t.Address)]\n            })\n            console.log(res)\n            let owned_nsfts = []\n            if (res !== null) {\n                owned_nsfts = res.filter(token => token.creatorAddress !== user?.addr)\n            }\n            dispatch({ type: 'OWNED_SUCCESS', payload: owned_nsfts })\n        } catch (err) {\n            console.log(err)\n            dispatch({ type: 'ERROR' })\n        }\n    }\n\n    const fetchUserLiveAuctions = async () => {\n        dispatch({ type: 'PROCESSING' })\n        try {\n            let res = await query({\n                cadence: GET_AUCTION_IDS,\n                args: (arg, t) => [arg(user?.addr, t.Address)]\n            })\n            let data = await fetchAuctionData(user?.addr, res)\n            dispatch({ type: 'AUCTION_SUCCESS', payload: data })\n        } catch(err) {\n            dispatch({ type: 'ERROR' })\n        }\n    }\n\n    const fetchUserLiveBids = async () => {\n        dispatch({ type: 'PROCESSING' })\n        try {\n            let response = await axios.get(`https://prod-test-net-dashboard-api.azurewebsites.net/api/company/04a74a09-619e-47f3-a6b4-99d24ce69971/search?user=${user?.addr}`)\n            const bidData = response.data;\n            const result = bidData.filter(event => event.flowEventId === \"A.a3c018ee20b2cb65.NFluenceAuction.BidPlaced\")\n            let tokens = result.filter((event, index, self) => \n                index === self.findIndex((e) => (\n                    e.blockEventData.tokenID === event.blockEventData.tokenID\n                ))\n            )\n            const livebids = fetchBidData(tokens)\n            dispatch({ type: 'BID_SUCCESS', payload: livebids })\n        } catch(err) {\n            dispatch({ type: 'ERROR' })\n        }\n\n    }\n\n    useEffect(() => {\n        if(!user?.addr) return\n        fetchUserMintedNsfts()\n        fetchUserOwnedNsfts()\n        fetchUserOwnedIds()\n        fetchUserLiveAuctions()\n        fetchUserLiveBids()\n        //eslint-disable-next-line\n    }, [user])\n\n\n    const fetchAccountLiveAuctions = async (address) => {\n        try {\n            let res = await query({\n                cadence: GET_AUCTION_IDS,\n                args: (arg, t) => [arg(address, t.Address)]\n            })\n            let data = await fetchAuctionData(address, res)\n            return data\n        } catch(err) {\n            console.log(err)\n        }\n    }\n\n    \n\n    \n\n    const addToAuction = async (nftid, price) => {\n        dispatch({ type: 'PROCESSING' })\n        try {\n            let res = await mutate({\n                cadence: CREATE_AUCTION,\n                args: (arg, t) => [\n                    arg(nftid, t.UInt64),\n                    arg(price, t.UFix64)\n                ],\n                limit: 9999\n            })\n            let txStatus = await tx(res).onceSealed()\n            console.log('done!')\n            console.log(txStatus)\n            dispatch({ type: 'TX_SUCCESS', payload: txStatus })\n            return txStatus\n        } catch(err) {\n            console.log(err)\n            dispatch({ type: 'ERROR' })\n        }\n    }\n\n    const bidOnAuction = async (nftid, address, price) => {\n        dispatch({ type: 'PROCESSING' })\n        try {\n            let res = await mutate({\n                cadence: BID_ON_AUCTION,\n                args: (arg, t) => [arg(nftid, t.UInt64), arg(address, t.Address), arg(price, t.UFix64)],\n                limit: 9999\n            })\n            let txStatus = await tx(res).onceSealed()\n            console.log(txStatus)\n            dispatch({ type: 'TX_SUCCESS', payload: txStatus })\n        } catch(err) {\n            console.log(err)\n            dispatch({ type: 'ERROR' })\n        }\n    }\n\n    const settleAuction = async (nftid) => {\n        console.log(state.error)\n        dispatch({ type: 'PROCESSING' })\n        try {\n            let res = await mutate({\n                cadence: SETTLE_AUCTION,\n                args: (arg, t) => [arg(nftid, t.UInt64)],\n                limit: 9999\n            })\n            let txStatus = await tx(res).onceSealed()\n            console.log(txStatus)\n            dispatch({ type: 'TX_SUCCESS', payload: txStatus })\n            return txStatus\n        } catch(err) {\n            console.log(err)\n            dispatch({ type: 'ERROR' })\n        }\n    }\n\n    const mintNsft = async (cid, fileType, title, description, editionSize) => {\n        dispatch({ type: 'PROCESSING' })\n        try {\n            let res = await mutate({\n                cadence: MINT_NSFT,\n                args: (arg, t) => [\n                    arg(user?.addr, t.Address),\n                    arg(cid, t.String),\n                    arg(fileType, t.UInt8),\n                    arg(title, t.String),\n                    arg(description, t.String),\n                    arg(editionSize, t.UInt16),\n                  ],\n                  limit: 9999,\n            })\n            //addTx(res)\n            let txStatus = await tx(res).onceSealed()\n            dispatch({ type: 'TX_SUCCESS', payload: txStatus })\n            return txStatus\n        } catch(err) {\n            console.log(err)\n            dispatch({ type: 'ERROR' })\n        }\n    }\n\n    return {\n        ...state,\n        mintNsft,\n        addToAuction,\n        settleAuction,\n        fetchAccountLiveAuctions,\n        fetchUserMintedNsfts,\n        fetchUserOwnedNsfts,\n        fetchUserOwnedIds,\n        bidOnAuction\n    }\n}"]},"metadata":{},"sourceType":"module"}