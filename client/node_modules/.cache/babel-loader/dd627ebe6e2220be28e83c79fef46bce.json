{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useEffect, useReducer } from \"react\";\nimport { userNsftReducer } from \"../reducer/userNsftReducer\";\nimport { mutate, query, tx } from '@onflow/fcl';\nimport { MINT_NSFT } from \"../flow/mint-nsft.tx\";\nimport { authorizationFunction } from \"../services/authorization-function\";\nimport { GET_TOKEN_DATA } from \"../flow/get-token-data.script\";\nimport { CREATE_AUCTION } from \"../flow/create-auction.tx\";\nimport { GET_AUCTION_IDS } from \"../flow/get-auction-ids.script\";\nimport { GET_SINGLE_AUCTION_DATA } from \"../flow/get-single-auction-data.script\";\nexport default function useUserNsfts(user) {\n  _s();\n\n  const [state, dispatch] = useReducer(userNsftReducer, {\n    loading: false,\n    error: false,\n    minted_data: [],\n    auction_data: [],\n    txStatus: {}\n  });\n  useEffect(() => {\n    if (!(user === null || user === void 0 ? void 0 : user.addr)) return;\n\n    const fetchUserMintedNsfts = async () => {\n      dispatch({\n        type: 'PROCESSING'\n      });\n\n      try {\n        let res = await query({\n          cadence: GET_TOKEN_DATA,\n          args: (arg, t) => [arg(user === null || user === void 0 ? void 0 : user.addr, t.Address)]\n        });\n        let minted_nsfts = res.filter(token => token.creatorAddress === (user === null || user === void 0 ? void 0 : user.addr));\n        dispatch({\n          type: 'MINTED_SUCCESS',\n          payload: minted_nsfts\n        });\n      } catch (err) {\n        console.log(err);\n        dispatch({\n          type: 'ERROR'\n        });\n      }\n    };\n\n    fetchUserMintedNsfts(); //eslint-disable-next-line\n  }, [user]);\n  useEffect(() => {\n    if (!(user === null || user === void 0 ? void 0 : user.addr)) return;\n\n    const runScript = async id => {\n      let auction_data = await query({\n        cadence: GET_SINGLE_AUCTION_DATA,\n        args: (arg, t) => [arg(user === null || user === void 0 ? void 0 : user.addr, t.Address), arg(id, t.UInt64)]\n      });\n      return auction_data;\n    };\n\n    const fetchAuctionData = async data => {\n      return Promise.all(data.map(id => {\n        return runScript(id);\n      }));\n    };\n\n    const fetchUserLiveAuctions = async () => {\n      dispatch({\n        type: 'PROCESSING'\n      });\n\n      try {\n        let res = await query({\n          cadence: GET_AUCTION_IDS,\n          args: (arg, t) => [arg(user === null || user === void 0 ? void 0 : user.addr, t.Address)]\n        });\n        let data = await fetchAuctionData(res);\n        dispatch({\n          type: 'AUCTION_SUCCESS',\n          payload: data\n        });\n      } catch (err) {\n        dispatch({\n          type: 'ERROR'\n        });\n      }\n    };\n\n    fetchUserLiveAuctions();\n  }, [user]);\n\n  const addToAuction = async (nftid, price) => {\n    dispatch({\n      type: 'PROCESSING'\n    });\n\n    try {\n      let res = await mutate({\n        cadence: CREATE_AUCTION,\n        args: (arg, t) => [arg(nftid, t.UInt64), arg(price, t.UFix64)],\n        limit: 500\n      });\n      let txStatus = await tx(res).onceSealed();\n      dispatch({\n        type: 'TX_SUCCESS',\n        payload: txStatus\n      });\n      return txStatus;\n    } catch (err) {\n      console.log(err);\n      dispatch({\n        type: 'ERROR'\n      });\n    }\n  };\n\n  const mintNsft = async (cid, fileType, title, description, editionSize) => {\n    dispatch({\n      type: 'PROCESSING'\n    });\n\n    try {\n      let res = await mutate({\n        cadence: MINT_NSFT,\n        args: (arg, t) => [arg(user === null || user === void 0 ? void 0 : user.addr, t.Address), arg(cid, t.String), arg(fileType, t.UInt8), arg(title, t.String), arg(description, t.String), arg(editionSize, t.UInt16)],\n        limit: 500,\n        authz: authorizationFunction\n      }); //addTx(res)\n\n      let txStatus = await tx(res).onceSealed();\n      dispatch({\n        type: 'TX_SUCCESS',\n        payload: txStatus\n      });\n      return txStatus;\n    } catch (err) {\n      console.log(err);\n      dispatch({\n        type: 'ERROR'\n      });\n    }\n  };\n\n  return { ...state,\n    mintNsft,\n    addToAuction\n  };\n}\n\n_s(useUserNsfts, \"+ja9Ar6u31Zmb/p6KQEC1GAc8RI=\");","map":{"version":3,"sources":["/Users/aidanhall/Desktop/nsft/client/src/hooks/use-user-nsfts.hook.js"],"names":["useEffect","useReducer","userNsftReducer","mutate","query","tx","MINT_NSFT","authorizationFunction","GET_TOKEN_DATA","CREATE_AUCTION","GET_AUCTION_IDS","GET_SINGLE_AUCTION_DATA","useUserNsfts","user","state","dispatch","loading","error","minted_data","auction_data","txStatus","addr","fetchUserMintedNsfts","type","res","cadence","args","arg","t","Address","minted_nsfts","filter","token","creatorAddress","payload","err","console","log","runScript","id","UInt64","fetchAuctionData","data","Promise","all","map","fetchUserLiveAuctions","addToAuction","nftid","price","UFix64","limit","onceSealed","mintNsft","cid","fileType","title","description","editionSize","String","UInt8","UInt16","authz"],"mappings":"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","sourcesContent":["import { useEffect, useReducer } from \"react\";\nimport { userNsftReducer } from \"../reducer/userNsftReducer\";\nimport { mutate, query, tx } from '@onflow/fcl';\nimport { MINT_NSFT } from \"../flow/mint-nsft.tx\";\nimport { authorizationFunction } from \"../services/authorization-function\";\nimport { GET_TOKEN_DATA } from \"../flow/get-token-data.script\";\nimport { CREATE_AUCTION } from \"../flow/create-auction.tx\";\nimport { GET_AUCTION_IDS } from \"../flow/get-auction-ids.script\";\nimport { GET_SINGLE_AUCTION_DATA } from \"../flow/get-single-auction-data.script\";\n\nexport default function useUserNsfts(user) {\n    const [state, dispatch] = useReducer(userNsftReducer, {\n        loading: false,\n        error: false,\n        minted_data: [],\n        auction_data: [],\n        txStatus: {}\n    })\n\n    useEffect(() => {\n        if(!user?.addr) return\n        const fetchUserMintedNsfts = async () => {\n            dispatch({ type: 'PROCESSING' })\n            try {\n                let res = await query({\n                    cadence: GET_TOKEN_DATA,\n                    args: (arg, t) => [arg(user?.addr, t.Address)]\n                })\n                let minted_nsfts = res.filter(token => token.creatorAddress === user?.addr)\n                dispatch({ type: 'MINTED_SUCCESS', payload: minted_nsfts })\n            } catch (err) {\n                console.log(err)\n                dispatch({ type: 'ERROR' })\n            }\n        }\n        fetchUserMintedNsfts()\n        //eslint-disable-next-line\n    }, [user])\n\n    useEffect(() => {\n        if(!user?.addr) return\n        const runScript = async id => {\n            let auction_data = await query({\n                cadence: GET_SINGLE_AUCTION_DATA,\n                args: (arg, t) => [arg(user?.addr, t.Address), arg(id, t.UInt64)]\n            })\n            return auction_data\n        }\n        const fetchAuctionData = async (data) => {\n            return Promise.all(data.map((id) => {\n                return runScript(id)\n            }))\n        }\n        const fetchUserLiveAuctions = async () => {\n            dispatch({ type: 'PROCESSING' })\n            try {\n                let res = await query({\n                    cadence: GET_AUCTION_IDS,\n                    args: (arg, t) => [arg(user?.addr, t.Address)]\n                })\n                let data = await fetchAuctionData(res)\n                dispatch({ type: 'AUCTION_SUCCESS', payload: data })\n            } catch(err) {\n                dispatch({ type: 'ERROR' })\n            }\n        }\n        fetchUserLiveAuctions()\n    }, [user])\n\n    const addToAuction = async (nftid, price) => {\n        dispatch({ type: 'PROCESSING' })\n        try {\n            let res = await mutate({\n                cadence: CREATE_AUCTION,\n                args: (arg, t) => [\n                    arg(nftid, t.UInt64),\n                    arg(price, t.UFix64)\n                ],\n                limit: 500\n            })\n            let txStatus = await tx(res).onceSealed()\n            dispatch({ type: 'TX_SUCCESS', payload: txStatus })\n            return txStatus\n        } catch(err) {\n            console.log(err)\n            dispatch({ type: 'ERROR' })\n        }\n    }\n\n    const mintNsft = async (cid, fileType, title, description, editionSize) => {\n        dispatch({ type: 'PROCESSING' })\n        try {\n            let res = await mutate({\n                cadence: MINT_NSFT,\n                args: (arg, t) => [\n                    arg(user?.addr, t.Address),\n                    arg(cid, t.String),\n                    arg(fileType, t.UInt8),\n                    arg(title, t.String),\n                    arg(description, t.String),\n                    arg(editionSize, t.UInt16),\n                  ],\n                  limit: 500,\n                  authz: authorizationFunction\n            })\n            //addTx(res)\n            let txStatus = await tx(res).onceSealed()\n            dispatch({ type: 'TX_SUCCESS', payload: txStatus })\n            return txStatus\n        } catch(err) {\n            console.log(err)\n            dispatch({ type: 'ERROR' })\n        }\n    }\n\n    return {\n        ...state,\n        mintNsft,\n        addToAuction\n    }\n}"]},"metadata":{},"sourceType":"module"}