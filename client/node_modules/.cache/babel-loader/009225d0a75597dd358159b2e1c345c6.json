{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useEffect, useReducer } from \"react\";\nimport { userNsftReducer } from \"../reducer/userNsftReducer\";\nimport { mutate, query, tx } from '@onflow/fcl';\nimport { MINT_NSFT } from \"../flow/mint-nsft.tx\";\nimport { authorizationFunction } from \"../services/authorization-function\";\nimport { GET_TOKEN_DATA } from \"../flow/get-token-data.script\";\nimport { CREATE_AUCTION } from \"../flow/create-auction.tx\";\nimport { GET_AUCTION_IDS } from \"../flow/get-auction-ids.script\";\nimport { GET_SINGLE_AUCTION_DATA } from \"../flow/get-single-auction-data.script\";\nimport { SETTLE_AUCTION } from \"../flow/settle-auction.tx\";\nimport { BID_ON_AUCTION } from \"../flow/bid-auction.tx\";\nexport default function useUserNsfts(user) {\n  _s();\n\n  const [state, dispatch] = useReducer(userNsftReducer, {\n    loading: false,\n    error: false,\n    minted_data: [],\n    auction_data: [],\n    owned_data: [],\n    txStatus: {}\n  });\n\n  const fetchUserMintedNsfts = async () => {\n    dispatch({\n      type: 'PROCESSING'\n    });\n\n    try {\n      let res = await query({\n        cadence: GET_TOKEN_DATA,\n        args: (arg, t) => [arg(user === null || user === void 0 ? void 0 : user.addr, t.Address)]\n      });\n      let minted_nsfts = [];\n\n      if (res !== null) {\n        minted_nsfts = res.filter(token => token.creatorAddress === (user === null || user === void 0 ? void 0 : user.addr));\n      }\n\n      dispatch({\n        type: 'MINTED_SUCCESS',\n        payload: minted_nsfts\n      });\n    } catch (err) {\n      console.log(err);\n      dispatch({\n        type: 'ERROR'\n      });\n    }\n  };\n\n  const fetchUserOwnedNsfts = async () => {\n    dispatch({\n      type: 'PROCESSING'\n    });\n\n    try {\n      let res = await query({\n        cadence: GET_TOKEN_DATA,\n        args: (arg, t) => [arg(user === null || user === void 0 ? void 0 : user.addr, t.Address)]\n      });\n      let owned_nsfts = [];\n\n      if (res !== null) {\n        owned_nsfts = res.filter(token => token.creatorAddress !== (user === null || user === void 0 ? void 0 : user.addr));\n      }\n\n      dispatch({\n        type: 'OWNED_SUCCESS',\n        payload: owned_nsfts\n      });\n    } catch (err) {\n      console.log(err);\n      dispatch({\n        type: 'ERROR'\n      });\n    }\n  };\n\n  useEffect(() => {\n    if (!(user === null || user === void 0 ? void 0 : user.addr)) return;\n    fetchUserMintedNsfts();\n    fetchUserOwnedNsfts(); //eslint-disable-next-line\n  }, [user]);\n\n  const runScript = async (address, id) => {\n    let auction_data = await query({\n      cadence: GET_SINGLE_AUCTION_DATA,\n      args: (arg, t) => [arg(address, t.Address), arg(id, t.UInt64)]\n    });\n    const {\n      nftData\n    } = auction_data;\n    return { ...auction_data,\n      ...nftData\n    };\n  };\n\n  const fetchAuctionData = async (address, data) => {\n    return Promise.all(data.map(id => {\n      return runScript(address, id);\n    }));\n  };\n\n  useEffect(() => {\n    if (!(user === null || user === void 0 ? void 0 : user.addr)) return;\n\n    const fetchUserLiveAuctions = async () => {\n      dispatch({\n        type: 'PROCESSING'\n      });\n\n      try {\n        let res = await query({\n          cadence: GET_AUCTION_IDS,\n          args: (arg, t) => [arg(user === null || user === void 0 ? void 0 : user.addr, t.Address)]\n        });\n        let data = await fetchAuctionData(user === null || user === void 0 ? void 0 : user.addr, res);\n        dispatch({\n          type: 'AUCTION_SUCCESS',\n          payload: data\n        });\n      } catch (err) {\n        dispatch({\n          type: 'ERROR'\n        });\n      }\n    };\n\n    fetchUserLiveAuctions(); //eslint-disable-next-line\n  }, [user]);\n\n  const fetchAccountLiveAuctions = async address => {\n    try {\n      let res = await query({\n        cadence: GET_AUCTION_IDS,\n        args: (arg, t) => [arg(address, t.Address)]\n      });\n      let data = await fetchAuctionData(address, res);\n      return data;\n    } catch (err) {\n      console.log(err);\n    }\n  };\n  /*\n  const fetchAccountLiveBids = async (address) => {\n      try {\n          let res = await query({\n           })\n      } catch(err) {\n          console.log(err)\n      }\n  }\n  */\n\n\n  const addToAuction = async (nftid, price) => {\n    dispatch({\n      type: 'PROCESSING'\n    });\n\n    try {\n      let res = await mutate({\n        cadence: CREATE_AUCTION,\n        args: (arg, t) => [arg(nftid, t.UInt64), arg(price, t.UFix64)],\n        limit: 500\n      });\n      let txStatus = await tx(res).onceSealed();\n      dispatch({\n        type: 'TX_SUCCESS',\n        payload: txStatus\n      });\n      return txStatus;\n    } catch (err) {\n      console.log(err);\n      dispatch({\n        type: 'ERROR'\n      });\n    }\n  };\n\n  const bidOnAuction = async (nftid, address, price) => {\n    dispatch({\n      type: 'PROCESSING'\n    });\n\n    try {\n      let res = await mutate({\n        cadence: BID_ON_AUCTION,\n        args: (arg, t) => [arg(nftid, t.UInt64), arg(address, t.Address), arg(price, t.UFix64)],\n        limit: 150\n      });\n      let txStatus = await tx(res).onceSealed();\n      dispatch({\n        type: 'TX_SUCCESS',\n        payload: txStatus\n      });\n    } catch (err) {\n      console.log(err);\n      dispatch({\n        type: 'ERROR'\n      });\n    }\n  };\n\n  const settleAuction = async nftid => {\n    console.log(state.error);\n    dispatch({\n      type: 'PROCESSING'\n    });\n\n    try {\n      let res = await mutate({\n        cadence: SETTLE_AUCTION,\n        args: (arg, t) => [arg(nftid, t.UInt64)],\n        limit: 500\n      });\n      let txStatus = await tx(res).onceSealed();\n      dispatch({\n        type: 'TX_SUCCESS',\n        payload: txStatus\n      });\n      return txStatus;\n    } catch (err) {\n      console.log(err);\n      dispatch({\n        type: 'ERROR'\n      });\n    }\n  };\n\n  const mintNsft = async (cid, fileType, title, description, editionSize) => {\n    dispatch({\n      type: 'PROCESSING'\n    });\n\n    try {\n      let res = await mutate({\n        cadence: MINT_NSFT,\n        args: (arg, t) => [arg(user === null || user === void 0 ? void 0 : user.addr, t.Address), arg(cid, t.String), arg(fileType, t.UInt8), arg(title, t.String), arg(description, t.String), arg(editionSize, t.UInt16)],\n        limit: 500,\n        authz: authorizationFunction\n      }); //addTx(res)\n\n      let txStatus = await tx(res).onceSealed();\n      dispatch({\n        type: 'TX_SUCCESS',\n        payload: txStatus\n      });\n      return txStatus;\n    } catch (err) {\n      console.log(err);\n      dispatch({\n        type: 'ERROR'\n      });\n    }\n  };\n\n  return { ...state,\n    mintNsft,\n    addToAuction,\n    settleAuction,\n    fetchAccountLiveAuctions,\n    fetchUserMintedNsfts,\n    fetchUserOwnedNsfts,\n    bidOnAuction\n  };\n}\n\n_s(useUserNsfts, \"dBkwFpqI+ZfokpMIrxsmK+X7kMw=\");","map":{"version":3,"sources":["/Users/aidanhall/Desktop/nsft/client/src/hooks/use-user-nsfts.hook.js"],"names":["useEffect","useReducer","userNsftReducer","mutate","query","tx","MINT_NSFT","authorizationFunction","GET_TOKEN_DATA","CREATE_AUCTION","GET_AUCTION_IDS","GET_SINGLE_AUCTION_DATA","SETTLE_AUCTION","BID_ON_AUCTION","useUserNsfts","user","state","dispatch","loading","error","minted_data","auction_data","owned_data","txStatus","fetchUserMintedNsfts","type","res","cadence","args","arg","t","addr","Address","minted_nsfts","filter","token","creatorAddress","payload","err","console","log","fetchUserOwnedNsfts","owned_nsfts","runScript","address","id","UInt64","nftData","fetchAuctionData","data","Promise","all","map","fetchUserLiveAuctions","fetchAccountLiveAuctions","addToAuction","nftid","price","UFix64","limit","onceSealed","bidOnAuction","settleAuction","mintNsft","cid","fileType","title","description","editionSize","String","UInt8","UInt16","authz"],"mappings":"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","sourcesContent":["import { useEffect, useReducer } from \"react\";\nimport { userNsftReducer } from \"../reducer/userNsftReducer\";\nimport { mutate, query, tx } from '@onflow/fcl';\nimport { MINT_NSFT } from \"../flow/mint-nsft.tx\";\nimport { authorizationFunction } from \"../services/authorization-function\";\nimport { GET_TOKEN_DATA } from \"../flow/get-token-data.script\";\nimport { CREATE_AUCTION } from \"../flow/create-auction.tx\";\nimport { GET_AUCTION_IDS } from \"../flow/get-auction-ids.script\";\nimport { GET_SINGLE_AUCTION_DATA } from \"../flow/get-single-auction-data.script\";\nimport { SETTLE_AUCTION } from \"../flow/settle-auction.tx\";\nimport { BID_ON_AUCTION } from \"../flow/bid-auction.tx\";\n\nexport default function useUserNsfts(user) {\n    const [state, dispatch] = useReducer(userNsftReducer, {\n        loading: false,\n        error: false,\n        minted_data: [],\n        auction_data: [],\n        owned_data: [],\n        txStatus: {}\n    })\n\n    const fetchUserMintedNsfts = async () => {\n        dispatch({ type: 'PROCESSING' })\n        try {\n            let res = await query({\n                cadence: GET_TOKEN_DATA,\n                args: (arg, t) => [arg(user?.addr, t.Address)]\n            })\n            let minted_nsfts = []\n            if (res !== null) {\n                minted_nsfts = res.filter(token => token.creatorAddress === user?.addr)\n            }\n            dispatch({ type: 'MINTED_SUCCESS', payload: minted_nsfts })\n        } catch (err) {\n            console.log(err)\n            dispatch({ type: 'ERROR' })\n        }\n    }\n\n    const fetchUserOwnedNsfts = async () => {\n        dispatch({ type: 'PROCESSING' })\n        try {\n            let res = await query({\n                cadence: GET_TOKEN_DATA,\n                args: (arg, t) => [arg(user?.addr, t.Address)]\n            })\n            let owned_nsfts = []\n            if (res !== null) {\n                owned_nsfts = res.filter(token => token.creatorAddress !== user?.addr)\n            }\n            dispatch({ type: 'OWNED_SUCCESS', payload: owned_nsfts })\n        } catch (err) {\n            console.log(err)\n            dispatch({ type: 'ERROR' })\n        }\n    }\n\n    useEffect(() => {\n        if(!user?.addr) return\n        fetchUserMintedNsfts()\n        fetchUserOwnedNsfts()\n        //eslint-disable-next-line\n    }, [user])\n\n    const runScript = async (address, id) => {\n        let auction_data = await query({\n            cadence: GET_SINGLE_AUCTION_DATA,\n            args: (arg, t) => [arg(address, t.Address), arg(id, t.UInt64)]\n        })\n        const { nftData } = auction_data\n        return {...auction_data, ...nftData}\n    }\n\n    const fetchAuctionData = async (address, data) => {\n        return Promise.all(data.map((id) => {\n            return runScript(address, id)\n        }))\n    }\n\n    useEffect(() => {\n        if(!user?.addr) return\n        const fetchUserLiveAuctions = async () => {\n            dispatch({ type: 'PROCESSING' })\n            try {\n                let res = await query({\n                    cadence: GET_AUCTION_IDS,\n                    args: (arg, t) => [arg(user?.addr, t.Address)]\n                })\n                let data = await fetchAuctionData(user?.addr, res)\n                dispatch({ type: 'AUCTION_SUCCESS', payload: data })\n            } catch(err) {\n                dispatch({ type: 'ERROR' })\n            }\n        }\n        fetchUserLiveAuctions()\n        //eslint-disable-next-line\n    }, [user])\n\n    const fetchAccountLiveAuctions = async (address) => {\n        try {\n            let res = await query({\n                cadence: GET_AUCTION_IDS,\n                args: (arg, t) => [arg(address, t.Address)]\n            })\n            let data = await fetchAuctionData(address, res)\n            return data\n        } catch(err) {\n            console.log(err)\n        }\n    }\n\n    /*\n    const fetchAccountLiveBids = async (address) => {\n        try {\n            let res = await query({\n\n            })\n        } catch(err) {\n            console.log(err)\n        }\n    }\n    */\n\n    const addToAuction = async (nftid, price) => {\n        dispatch({ type: 'PROCESSING' })\n        try {\n            let res = await mutate({\n                cadence: CREATE_AUCTION,\n                args: (arg, t) => [\n                    arg(nftid, t.UInt64),\n                    arg(price, t.UFix64)\n                ],\n                limit: 500\n            })\n            let txStatus = await tx(res).onceSealed()\n            dispatch({ type: 'TX_SUCCESS', payload: txStatus })\n            return txStatus\n        } catch(err) {\n            console.log(err)\n            dispatch({ type: 'ERROR' })\n        }\n    }\n\n    const bidOnAuction = async (nftid, address, price) => {\n        dispatch({ type: 'PROCESSING' })\n        try {\n            let res = await mutate({\n                cadence: BID_ON_AUCTION,\n                args: (arg, t) => [arg(nftid, t.UInt64), arg(address, t.Address), arg(price, t.UFix64)],\n                limit: 150\n            })\n            let txStatus = await tx(res).onceSealed()\n            dispatch({ type: 'TX_SUCCESS', payload: txStatus })\n        } catch(err) {\n            console.log(err)\n            dispatch({ type: 'ERROR' })\n        }\n    }\n\n    const settleAuction = async (nftid) => {\n        console.log(state.error)\n        dispatch({ type: 'PROCESSING' })\n        try {\n            let res = await mutate({\n                cadence: SETTLE_AUCTION,\n                args: (arg, t) => [arg(nftid, t.UInt64)],\n                limit: 500\n            })\n            let txStatus = await tx(res).onceSealed()\n            dispatch({ type: 'TX_SUCCESS', payload: txStatus })\n            return txStatus\n        } catch(err) {\n            console.log(err)\n            dispatch({ type: 'ERROR' })\n        }\n    }\n\n    const mintNsft = async (cid, fileType, title, description, editionSize) => {\n        dispatch({ type: 'PROCESSING' })\n        try {\n            let res = await mutate({\n                cadence: MINT_NSFT,\n                args: (arg, t) => [\n                    arg(user?.addr, t.Address),\n                    arg(cid, t.String),\n                    arg(fileType, t.UInt8),\n                    arg(title, t.String),\n                    arg(description, t.String),\n                    arg(editionSize, t.UInt16),\n                  ],\n                  limit: 500,\n                  authz: authorizationFunction\n            })\n            //addTx(res)\n            let txStatus = await tx(res).onceSealed()\n            dispatch({ type: 'TX_SUCCESS', payload: txStatus })\n            return txStatus\n        } catch(err) {\n            console.log(err)\n            dispatch({ type: 'ERROR' })\n        }\n    }\n\n    return {\n        ...state,\n        mintNsft,\n        addToAuction,\n        settleAuction,\n        fetchAccountLiveAuctions,\n        fetchUserMintedNsfts,\n        fetchUserOwnedNsfts,\n        bidOnAuction\n    }\n}"]},"metadata":{},"sourceType":"module"}